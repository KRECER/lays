<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Megogo</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/css/style-min.css">
</head>
<body>
<div class="visually-hidden">
	<include src="build/img/sprite.svg"></include>
</div>
<section class="megago">
	<div class="megago__lenth"></div>
	<div class="megago__headers">
		<div class="megago__arrows">
			<img src="/img/megago/arrows.png" alt=""><a href="/">НА САЙТ</a>
		</div>
		<div class="megago__camera">
			<img src="/img/megago/cinema.png" alt="">
		</div>
		<div class="megago__logo">
			<div>
				<img src="/img/megago/logo.png" alt="">
			</div>
		</div>
		<div class="megago__films">
			<img src="/img/megago/films.png" alt="">
		</div>
	</div>
	<div class="megago__text">
			<div class="megago__arrows">
					<img src="/img/megago/arrows.png" alt=""><a href="/">НА САЙТ</a>
				</div>
		<div class="megago__logo">
				<div>
					<img src="/img/megago/logo.png" alt="">
				</div>
			</div>
		<div class="megago__watching">
			<img src="/img/megago/watching.png" alt="">
			<h2>
				ОТРИМАВ ПРОМО-КОД НА БЕЗКОШТОВНУ ПІДПИСКУ?
			</h2>
			<div>Вітаємо! <br>
			Ти маєш 7 днів перегляду пакету «Кіно і ТБ: Оптимальна» безкоштовно! <br> Активуй отриманий промо-код не пізніше <span>23 квітня 2019 року</span>.<br>Активацію промо-коду може здійснити лише Власник промо-коду – Учасник Акції з належним лише йому номером мобільного телефону, який ти використовував при реєстрації акційного коду з акційної пачки Lay’s.*
			</div>
			<h2>ЩОБ РОЗПОЧАТИ ПЕРЕГЛЯД:</h2>
		</div>
		<form class="megago__form" id="code-registration-form">
			<div>
				<div class="circle">1</div>
				<input type="tel" required name="phone" id="phone-input" placeholder="НОМЕР МОБІЛЬНОГО ТЕЛЕФОНУ" class="tel" minlength="18" maxlength="18">
			</div>
			<div>
				<div class="circle">2</div>
				<input type="text" required name="megogo" id="code-input" placeholder="ПРОМО-КОД MEGOGO" minlength="12" maxlength="12">
			</div>
			<button class="megago__btn button" id="submit-btn">ПРОДОВЖИТИ
				<svg class="hollywood__icon-triangle">
					<use xlink:href="#icon-triangle"></use>
				</svg>
			</button>

			<div class="megago__films">
				<img src="/img/megago/films.png" alt="">
			</div>

		</form>

		<div class="megago__footer">
			* Маються на увазі тільки пачки ТМ «LAY’S» з акційним  банером «КІНО СМАКУЄ КРАЩЕ З LAY’S» так кодом всередині.
		</div>
	</div>
</section>
<section class="preloader">
	<svg class="btn__icon preloader__icon" width="95" height="94" id="send-code">
		<use xlink:href="#icon-wheel" class="animationSvg"></use>
	</svg>
</section>

<include src="src/template/textModal.html"></include>

<script src="/js/plugins.js"></script>

<script>
$(".megago__form [type=tel]").mask("+38(999) 999-99-99");

var submitBtn = document.querySelector("#submit-btn");
var form = document.querySelector("#code-registration-form");

if (submitBtn) {
  // submitBtn.addEventListener('click', function(event) {
  form.addEventListener('submit', function(event) {
    event.preventDefault();

    var preloader = document.querySelector(".preloader"); 
    var form = document.querySelector("#code-registration-form");
    var data = new FormData(form);

    var request = new XMLHttpRequest();
    request.open('POST', '/api/megogo/', true);
    request.send(data);
    preloader.style.display = 'block'



    request.addEventListener('readystatechange', function() {
		preloader.style.display = 'none';
        if (request.status === 200 && request.readyState === 4) {
            var response = JSON.parse(request.response);
            if (response.status) {
              openMegagoTextModal({
                  title: response.message.title,
                  text: response.message.body,
                  btn: {
                      text: 'ПЕРЕЙТИ ДО ПЕРЕГЛЯДУ',
                      link: 'https://megogo.net/ru/auth_register',
                  }
              });
            }
            else {
              openMegagoTextModal({
                  title: response.message.title,
                  text: response.message.body,
              });
            }
        }
    });
  });
}

var textModal = document.querySelector('.js-text-modal');

function openMegagoTextModal(param) {
  var title = textModal.querySelector('.js-title');
  var text = textModal.querySelector('.js-text');
  var modalImg = textModal.querySelector('.js-img');
  var modalBtn = textModal.querySelector('.js-btn');
  title.innerHTML = param.title || '';
  text.innerHTML = param.text || '';
  if (param.hasOwnProperty('imagePath')) {
    modalImg.setAttribute('src', param.imagePath);
    modalImg.setAttribute('alt', param.imageAlt || '');
  } else {
    modalImg.style.display = "none";
  }

  if (param.hasOwnProperty('btn')) {
    console.log(param.btn);
    modalBtn.style.display = "flex";
    modalBtn.innerHTML = param.btn.text;
    modalBtn.setAttribute('href', param.btn.link);
  } else {
    modalBtn.style.display = "none";
  }
  openMegagoModal(textModal);
}

function openMegagoModal(modal) {
  modal.style.display = 'flex';
  modal.style.zIndex = 23;
}

var closeTextModalBtn = textModal.querySelector('.js-close');

closeTextModalBtn.addEventListener('click', function (e) {
  textModal.style.display = 'none';
});

</script>
</body>
</html>

